<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Billing Software - Laxmi Electronics</title>

<!-- PDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f2f4f7;padding:20px}
.container{max-width:1000px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
h1{text-align:center;margin-top:0}
input,select,button{padding:8px;margin:5px;border-radius:6px;border:1px solid #ccc}
button{background:#007bff;color:#fff;border:none;cursor:pointer}
button:hover{background:#0056b3}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#007bff;color:#fff}
.total{font-size:18px;font-weight:bold;text-align:right;margin-top:10px}
</style>
</head>
<body>

<div class="container">
<h1>Laxmi Electronics</h1>

<!-- ================= INVOICE INFO ================= -->
<h3>
Invoice No: <span id="invoiceNo"></span><br>
Date & Time: <span id="dateTime"></span>
</h3>


<!-- ================= CUSTOMER ================= -->
<h3>Customer Details</h3>

<input type="text" id="custName" placeholder="Customer Name">
<input type="text" id="custMobile" placeholder="Mobile Number">


<!-- ================= PRODUCT PANEL ================= -->
<h3>Add Product (Stock)</h3>

<input type="text" id="pName" placeholder="Product Name">
<input type="number" id="pPrice" placeholder="Price">
<input type="number" id="pStock" placeholder="Stock Qty">

<button onclick="addProduct()">Add Product</button>

<table id="productTable">
<thead>
<tr>
<th>Name</th>
<th>Price</th>
<th>Stock</th>
</tr>
</thead>
<tbody></tbody>
</table>


<!-- ================= BILLING ================= -->
<h3>Create Bill</h3>

<select id="productList"></select>
<input type="number" id="qty" placeholder="Qty">
<button onclick="addItem()">Add Item</button>

<table id="billTable">
<thead>
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Total</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="total">Grand Total ₹ <span id="grandTotal">0</span></div>

<button onclick="downloadPDF()">Download Invoice PDF</button>

</div>


<script>

// ================= AUTO INVOICE =================
const invoiceNumber = 'INV' + Math.floor(10000 + Math.random()*90000);
document.getElementById('invoiceNo').innerText = invoiceNumber;

const now = new Date();
document.getElementById('dateTime').innerText = now.toLocaleString();


// ================= STORAGE =================
let products = JSON.parse(localStorage.getItem('products')) || [];
let grandTotal = 0;
let billItems = [];


// ================= LOAD PRODUCTS =================
function loadProducts(){

const dropdown=document.getElementById('productList');
const table=document.querySelector('#productTable tbody');

dropdown.innerHTML='<option value="">Select Item</option>';
table.innerHTML='';

products.forEach((p,i)=>{

const opt=document.createElement('option');
opt.value=i;
opt.textContent=`${p.name} ₹${p.price} | Stock:${p.stock}`;
dropdown.appendChild(opt);

const row=table.insertRow();
row.insertCell(0).innerText=p.name;
row.insertCell(1).innerText=p.price;
row.insertCell(2).innerText=p.stock;
});
}
loadProducts();


// ================= ADD PRODUCT =================
function addProduct(){

const name=pName.value.trim();
const price=parseFloat(pPrice.value);
const stock=parseFloat(pStock.value);

if(!name||isNaN(price)||isNaN(stock)){
alert('Fill all fields');return;
}

products.push({name,price,stock});
localStorage.setItem('products',JSON.stringify(products));
loadProducts();

pName.value='';pPrice.value='';pStock.value='';
}


// ================= BILLING =================
function addItem(){

const i=productList.value;
const qty=parseFloat(document.getElementById('qty').value);

if(i===''||isNaN(qty)){
alert('Select item & qty');return;
}

const p=products[i];

if(qty>p.stock){
alert('Insufficient stock');return;
}

p.stock-=qty;
localStorage.setItem('products',JSON.stringify(products));
loadProducts();

let total=qty*p.price;
grandTotal+=total;

const row=billTable.querySelector('tbody').insertRow();
row.insertCell(0).innerText=p.name;
row.insertCell(1).innerText=qty;
row.insertCell(2).innerText=p.price;
row.insertCell(3).innerText=total.toFixed(2);

billItems.push({name:p.name,qty,price:p.price,total});

document.getElementById('grandTotal').innerText=grandTotal.toFixed(2);
}


// ================= PDF INVOICE =================
function downloadPDF(){

if(billItems.length===0){
alert('No bill items');return;
}

const custName=document.getElementById('custName').value || 'N/A';
const custMobile=document.getElementById('custMobile').value || 'N/A';

const { jsPDF } = window.jspdf;
const doc = new jsPDF();

let y=20;

// Logo placeholder box
doc.rect(150,10,40,20);
doc.text('LOGO',160,22);

// Firm details
doc.setFontSize(14);
doc.text('Laxmi Electronics',20,15);

doc.setFontSize(10);
doc.text('Old Indira Colony, Opposite Rajesh Thakur Bunglow,',20,22);
doc.text('Beside Laxmi Provision and Coldrinks',20,28);

// Invoice info
doc.text(`Invoice No: ${invoiceNumber}`,20,38);
doc.text(`Date: ${now.toLocaleString()}`,20,44);

// Customer

doc.text(`Customer: ${custName}`,20,54);
doc.text(`Mobile: ${custMobile}`,20,60);

// Items

y=70;
billItems.forEach(item=>{
doc.text(`${item.name} x${item.qty} = ₹${item.total}`,20,y);
y+=10;
});

// Total

doc.text(`Grand Total: ₹${grandTotal.toFixed(2)}`,20,y+10);

// Save

doc.save(`Invoice_${invoiceNumber}.pdf`);
}


// ================= TESTS =================
console.assert(typeof invoiceNumber==='string','Invoice error');
console.assert(typeof grandTotal==='number','Total error');

</script>
</body>
</html>

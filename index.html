<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GST Billing Software</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Arial;background:#f2f4f7;padding:20px}
.container{max-width:1200px;margin:auto;background:#fff;padding:20px;border-radius:10px}
input,textarea,button{padding:8px;margin:5px;border-radius:6px;border:1px solid #ccc}
button{background:#007bff;color:#fff;border:none;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#007bff;color:#fff}
.action-btn{padding:4px 8px;font-size:12px;margin:2px}
.total{font-weight:bold;text-align:right;margin-top:5px}
.history-box{margin-top:30px}
</style>
</head>
<body>

<div class="container">
<h2>GST Invoice Billing Software</h2>

<h3>Seller Details</h3>
<input id="sellerName" placeholder="Store Name">
<textarea id="sellerAddress" placeholder="Store Address"></textarea>
<input id="sellerContact" placeholder="Shop Contact">
<input id="sellerGST" placeholder="GSTIN">
<input id="sellerState" placeholder="State Name">

<h3>Buyer Details</h3>
<input id="buyerName" placeholder="Buyer Name">
<textarea id="buyerAddress" placeholder="Buyer Address"></textarea>
<input id="buyerContact" placeholder="Customer Contact">
<input id="buyerGST" placeholder="Buyer GSTIN">
<input id="buyerState" placeholder="Buyer State Name">

<h3>Invoice</h3>
<input id="invoiceNo" placeholder="Invoice Number (Optional)">
<input type="date" id="invoiceDate">

<h3>Add Product</h3>
<input type="hidden" id="editIndex">
<input id="itemName" placeholder="Item Name">
<input id="hsn" placeholder="HSN Code">
<input type="number" id="qty" placeholder="Quantity">
<input type="number" id="rate" placeholder="Rate (GST Included)">
<input type="number" id="gstPercent" placeholder="GST %">
<button onclick="saveItem()">Save Product</button>

<table id="billTable">
<thead>
<tr>
<th>Description</th>
<th>HSN</th>
<th>Qty</th>
<th>Rate</th>
<th>GST %</th>
<th>Amount</th>
<th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="total">Taxable Value ₹ <span id="taxable">0</span></div>
<div class="total">CGST ₹ <span id="cgst">0</span></div>
<div class="total">SGST ₹ <span id="sgst">0</span></div>
<div class="total">IGST ₹ <span id="igst">0</span></div>
<div class="total">Grand Total ₹ <span id="grand">0</span></div>

<button onclick="downloadPDF()">Download GST Invoice PDF</button>
<button onclick="saveInvoiceHistory()">Save Invoice</button>

<div class="history-box">
<h3>Invoice History</h3>
<table id="historyTable">
<thead>
<tr>
<th>Invoice No</th>
<th>Date</th>
<th>Customer</th>
<th>Total</th>
<th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<script>

let items=[];
let taxable=0, cgstTotal=0, sgstTotal=0, igstTotal=0, grandTotal=0;
let invoiceHistory=JSON.parse(localStorage.getItem("invoiceHistory"))||[];

function saveItem(){

const name=itemName.value;
const hsnCode=hsn.value;
const quantity=parseFloat(qty.value);
const rateValue=parseFloat(rate.value);
const gst=parseFloat(gstPercent.value)||0;
const editIndex=document.getElementById("editIndex").value;

if(!name||isNaN(quantity)||isNaN(rateValue)) return alert("Fill product details");

const gross = quantity * rateValue;
let base = gross;
let gstAmount = 0;

if(gst > 0){
base = (gross * 100) / (100 + gst);
gstAmount = gross - base;
}

const sellerState=sellerState.value.trim().toLowerCase();
const buyerState=buyerState.value.trim().toLowerCase();

let cg=0, sg=0, ig=0;

if(sellerState && buyerState && sellerState!==buyerState){
ig=gstAmount;
}else{
cg=gstAmount/2;
sg=gstAmount/2;
}

const total=gross;

const product={name,hsnCode,quantity,rate:rateValue,gst,base,gstAmount,total,cg,sg,ig};

if(editIndex===""){
items.push(product);
}else{
items[editIndex]=product;
}

clearForm();
renderTable();
calculateTotals();
}

function renderTable(){
const tbody=document.querySelector("#billTable tbody");
tbody.innerHTML="";

items.forEach((item,index)=>{
const row=tbody.insertRow();
row.insertCell(0).innerText=item.name;
row.insertCell(1).innerText=item.hsnCode;
row.insertCell(2).innerText=item.quantity;
row.insertCell(3).innerText=item.rate;
row.insertCell(4).innerText=item.gst+"%";
row.insertCell(5).innerText=item.total.toFixed(2);

const action=row.insertCell(6);

const editBtn=document.createElement("button");
editBtn.innerText="Edit";
editBtn.className="action-btn";
editBtn.onclick=()=>editItem(index);

const deleteBtn=document.createElement("button");
deleteBtn.innerText="Delete";
deleteBtn.className="action-btn";
deleteBtn.style.background="red";
deleteBtn.onclick=()=>deleteItem(index);

action.appendChild(editBtn);
action.appendChild(deleteBtn);
});
}

function calculateTotals(){
taxable=0; cgstTotal=0; sgstTotal=0; igstTotal=0;

items.forEach(item=>{
taxable+=item.base;
cgstTotal+=item.cg;
sgstTotal+=item.sg;
igstTotal+=item.ig;
});

grandTotal=taxable+cgstTotal+sgstTotal+igstTotal;

document.getElementById("taxable").innerText=taxable.toFixed(2);
document.getElementById("cgst").innerText=cgstTotal.toFixed(2);
document.getElementById("sgst").innerText=sgstTotal.toFixed(2);
document.getElementById("igst").innerText=igstTotal.toFixed(2);
document.getElementById("grand").innerText=grandTotal.toFixed(2);
}

function saveInvoiceHistory(){
const invoiceData={
invoiceNo:invoiceNo.value||"N/A",
date:invoiceDate.value||new Date().toISOString().split("T")[0],
customer:buyerName.value||"Walk-in",
total:grandTotal.toFixed(2),
items:items
};

invoiceHistory.push(invoiceData);
localStorage.setItem("invoiceHistory",JSON.stringify(invoiceHistory));
renderHistory();
alert("Invoice Saved Successfully!");
}

function renderHistory(){
const tbody=document.querySelector("#historyTable tbody");
tbody.innerHTML="";

invoiceHistory.forEach((inv,index)=>{
const row=tbody.insertRow();
row.insertCell(0).innerText=inv.invoiceNo;
row.insertCell(1).innerText=inv.date;
row.insertCell(2).innerText=inv.customer;
row.insertCell(3).innerText=inv.total;

const action=row.insertCell(4);
const delBtn=document.createElement("button");
delBtn.innerText="Delete";
delBtn.className="action-btn";
delBtn.style.background="red";
delBtn.onclick=()=>deleteInvoice(index);

action.appendChild(delBtn);
});
}

function deleteInvoice(index){
if(confirm("Delete this invoice?")){
invoiceHistory.splice(index,1);
localStorage.setItem("invoiceHistory",JSON.stringify(invoiceHistory));
renderHistory();
}
}

renderHistory();

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Billing Software</title>

<!-- High Quality PDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Arial;background:#f2f4f7;padding:20px}
.container{max-width:1000px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
h1{text-align:center;margin-top:0}
input,textarea,select,button{padding:8px;margin:5px;border-radius:6px;border:1px solid #ccc;width:100%;max-width:350px}
button{background:#007bff;color:#fff;border:none;cursor:pointer;width:auto}
button:hover{background:#0056b3}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#007bff;color:#fff}
.total{font-size:18px;font-weight:bold;text-align:right;margin-top:10px}
.taxbox{display:flex;gap:10px;flex-wrap:wrap}
.datebox{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
</style>
</head>
<body>

<div class="container">

<!-- STORE DETAILS -->
<h2>Store Details</h2>
<input type="text" id="storeName" placeholder="Store Name">
<textarea id="storeAddress" rows="2" placeholder="Shop Address"></textarea>
<input type="text" id="storeContact" placeholder="Shop Contact">
<input type="text" id="gstNo" placeholder="GST Number">
<input type="text" id="invoiceNoInput" placeholder="Invoice Number">


<!-- DATE OPTIONS -->
<h3>Bill Date</h3>
<div class="datebox">
<label><input type="radio" name="dateOption" value="current" checked onchange="setCurrentDate()"> Current Date</label>
<label><input type="radio" name="dateOption" value="custom" onchange="enableCustomDate()"> Change Date</label>
<input type="datetime-local" id="customDate" disabled>
</div>

<h3>Date & Time: <span id="dateTime"></span></h3>


<!-- CUSTOMER -->
<h3>Customer Details</h3>
<input type="text" id="custName" placeholder="Customer Name">
<input type="text" id="custMobile" placeholder="Mobile Number">


<!-- PRODUCT PANEL -->
<h3>Add Product</h3>
<input type="text" id="pName" placeholder="Product Name">
<input type="number" id="pPrice" placeholder="Price">
<input type="number" id="pStock" placeholder="Stock Qty">
<button onclick="addProduct()">Add Product</button>
<button onclick="clearProducts()">Clear Old Product List</button>

<table id="productTable">
<thead><tr><th>Name</th><th>Price</th><th>Stock</th></tr></thead>
<tbody></tbody>
</table>


<!-- BILLING -->
<h3>Create Bill</h3>
<select id="productList"></select>
<input type="number" id="qtyInput" placeholder="Qty">
<button onclick="addItem()">Add Item</button>

<table id="billTable">
<thead>
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Total</th>
</tr>
</thead>
<tbody></tbody>
</table>


<!-- TAX -->
<h3>GST / TAX</h3>
<div class="taxbox">
<input type="number" id="igst" placeholder="IGST %">
<input type="number" id="cgst" placeholder="CGST %">
<input type="number" id="sgst" placeholder="SGST %">
</div>

<div class="total">Sub Total ₹ <span id="subTotal">0</span></div>
<div class="total">Total Tax ₹ <span id="taxTotal">0</span></div>
<div class="total">Grand Total ₹ <span id="grandTotal">0</span></div>

<button onclick="downloadPDF()">Download Invoice PDF</button>

</div>

<script>

// ================= DATE SYSTEM =================

function setCurrentDate(){
  document.getElementById('customDate').disabled=true;
  updateDateDisplay(new Date());
}

function enableCustomDate(){
  document.getElementById('customDate').disabled=false;
}

function updateDateDisplay(date){
  document.getElementById('dateTime').innerText=date.toLocaleString();
}

// Default current date
let billDate=new Date();
updateDateDisplay(billDate);

// When custom date changes

document.getElementById('customDate').addEventListener('change',function(){
  if(this.value){
    billDate=new Date(this.value);
    updateDateDisplay(billDate);
  }
});


// ================= STORAGE =================
let products=JSON.parse(localStorage.getItem('products'))||[];
let subTotal=0;
let grandTotal=0;
let billItems=[];


// LOAD PRODUCTS
function loadProducts(){
productList.innerHTML='<option value="">Select Item</option>';
productTable.querySelector('tbody').innerHTML='';

products.forEach((p,i)=>{
const opt=document.createElement('option');
opt.value=i;
opt.textContent=`${p.name} ₹${p.price} | Stock:${p.stock}`;
productList.appendChild(opt);

const row=productTable.querySelector('tbody').insertRow();
row.insertCell(0).innerText=p.name;
row.insertCell(1).innerText=p.price;
row.insertCell(2).innerText=p.stock;
});
}
loadProducts();


// ADD PRODUCT
function addProduct(){
const name=pName.value.trim();
const price=parseFloat(pPrice.value);
const stock=parseFloat(pStock.value);
if(!name||isNaN(price)||isNaN(stock)) return alert('Fill fields');
products.push({name,price,stock});
localStorage.setItem('products',JSON.stringify(products));
loadProducts();
}


// CLEAR PRODUCTS
function clearProducts(){
if(confirm('Delete all products?')){
products=[];
localStorage.removeItem('products');
loadProducts();
}
}


// BILLING
function addItem(){

const i=productList.value;
const qty=parseFloat(qtyInput.value);

if(i===''||isNaN(qty)) return alert('Select item & qty');

const p=products[i];
if(qty>p.stock) return alert('Insufficient stock');

p.stock-=qty;
localStorage.setItem('products',JSON.stringify(products));
loadProducts();

let total=qty*p.price;
subTotal+=total;

const row=billTable.querySelector('tbody').insertRow();
row.insertCell(0).innerText=p.name;
row.insertCell(1).innerText=qty;
row.insertCell(2).innerText=p.price;
row.insertCell(3).innerText=total.toFixed(2);

billItems.push([p.name,qty,p.price,total.toFixed(2)]);

calculateTax();
}


// TAX
function calculateTax(){
const igst=parseFloat(document.getElementById('igst').value)||0;
const cgst=parseFloat(document.getElementById('cgst').value)||0;
const sgst=parseFloat(document.getElementById('sgst').value)||0;

const taxAmount=subTotal*(igst+cgst+sgst)/100;

grandTotal=subTotal+taxAmount;

document.getElementById('subTotal').innerText=subTotal.toFixed(2);
document.getElementById('taxTotal').innerText=taxAmount.toFixed(2);
document.getElementById('grandTotal').innerText=grandTotal.toFixed(2);
}


// PDF
function downloadPDF(){

const storeName=document.getElementById('storeName').value||'Store';
const address=document.getElementById('storeAddress').value||'';
const contact=document.getElementById('storeContact').value||'';
const gst=document.getElementById('gstNo').value||'';
const invoice=document.getElementById('invoiceNoInput').value||'N/A';

const cust=document.getElementById('custName').value||'N/A';
const mobile=document.getElementById('custMobile').value||'N/A';

const { jsPDF } = window.jspdf;
const doc=new jsPDF();

// HEADER

doc.setFontSize(16);
doc.text(storeName,14,15);
doc.setFontSize(10);
doc.text(address,14,22,{maxWidth:120});
doc.text(`Contact: ${contact}`,14,28);
doc.text(`GST: ${gst}`,14,34);

doc.text(`Invoice: ${invoice}`,14,42);
doc.text(`Date: ${billDate.toLocaleString()}`,14,48);

doc.text(`Customer: ${cust}`,14,56);
doc.text(`Mobile: ${mobile}`,14,62);

// TABLE

doc.autoTable({
startY:70,
head:[['Item','Qty','Price','Total']],
body:billItems
});

let y=doc.lastAutoTable.finalY+10;

doc.text(`Grand Total: ₹ ${grandTotal.toFixed(2)}`,140,y);

doc.save(`Invoice_${invoice}.pdf`);
}


// TEST
console.assert(Array.isArray(products),'Products error');

</script>
</body>
</html>

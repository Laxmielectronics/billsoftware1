<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Billing Software</title>

<!-- High Quality PDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Arial;background:#f2f4f7;padding:20px}
.container{max-width:1000px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
h1{text-align:center;margin-top:0}
input,select,button{padding:8px;margin:5px;border-radius:6px;border:1px solid #ccc}
button{background:#007bff;color:#fff;border:none;cursor:pointer}
button:hover{background:#0056b3}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#007bff;color:#fff}
.total{font-size:18px;font-weight:bold;text-align:right;margin-top:10px}
</style>
</head>
<body>

<div class="container">

<!-- ================= STORE DETAILS ================= -->
<h2>Store Details</h2>

<input type="text" id="storeName" placeholder="Store Name (e.g. Laxmi Electronics)">
<input type="text" id="gstNo" placeholder="GST Number (Optional)">
<input type="text" id="invoiceNoInput" placeholder="Invoice Number">


<!-- DATE TIME -->
<h3>
Date & Time: <span id="dateTime"></span>
</h3>


<!-- CUSTOMER -->
<h3>Customer Details</h3>
<input type="text" id="custName" placeholder="Customer Name">
<input type="text" id="custMobile" placeholder="Mobile Number">


<!-- PRODUCT PANEL -->
<h3>Add Product (Stock)</h3>
<input type="text" id="pName" placeholder="Product Name">
<input type="number" id="pPrice" placeholder="Price">
<input type="number" id="pStock" placeholder="Stock Qty">

<button onclick="addProduct()">Add Product</button>
<button onclick="clearProducts()">Clear Old Product List</button>

<table id="productTable">
<thead>
<tr><th>Name</th><th>Price</th><th>Stock</th></tr>
</thead>
<tbody></tbody>
</table>


<!-- BILLING -->
<h3>Create Bill</h3>
<select id="productList"></select>
<input type="number" id="qty" placeholder="Qty">
<button onclick="addItem()">Add Item</button>

<table id="billTable">
<thead>
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Total</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="total">Grand Total ₹ <span id="grandTotal">0</span></div>

<button onclick="downloadPDF()">Download Invoice PDF</button>

</div>

<script>

// DATE TIME
const now = new Date();
document.getElementById('dateTime').innerText = now.toLocaleString();


// STORAGE
let products = JSON.parse(localStorage.getItem('products')) || [];
let grandTotal = 0;
let billItems = [];


// LOAD PRODUCTS
function loadProducts(){

productList.innerHTML='<option value="">Select Item</option>';
productTable.querySelector('tbody').innerHTML='';

products.forEach((p,i)=>{

const opt=document.createElement('option');
opt.value=i;
opt.textContent=`${p.name} ₹${p.price} | Stock:${p.stock}`;
productList.appendChild(opt);

const row=productTable.querySelector('tbody').insertRow();
row.insertCell(0).innerText=p.name;
row.insertCell(1).innerText=p.price;
row.insertCell(2).innerText=p.stock;
});
}
loadProducts();


// ADD PRODUCT
function addProduct(){

const name=pName.value.trim();
const price=parseFloat(pPrice.value);
const stock=parseFloat(pStock.value);

if(!name||isNaN(price)||isNaN(stock)){
alert('Fill all fields');return;
}

products.push({name,price,stock});
localStorage.setItem('products',JSON.stringify(products));
loadProducts();

pName.value='';pPrice.value='';pStock.value='';
}


// CLEAR PRODUCTS
function clearProducts(){
if(confirm('Delete all old products?')){
products=[];
localStorage.removeItem('products');
loadProducts();
}
}


// BILLING
function addItem(){

const i=productList.value;
const qty=parseFloat(document.getElementById('qty').value);

if(i===''||isNaN(qty)){
alert('Select item & qty');return;
}

const p=products[i];
if(qty>p.stock){alert('Insufficient stock');return;}

p.stock-=qty;
localStorage.setItem('products',JSON.stringify(products));
loadProducts();

let total=qty*p.price;
grandTotal+=total;

const row=billTable.querySelector('tbody').insertRow();
row.insertCell(0).innerText=p.name;
row.insertCell(1).innerText=qty;
row.insertCell(2).innerText=p.price;
row.insertCell(3).innerText=total.toFixed(2);

billItems.push([p.name,qty,p.price,total.toFixed(2)]);

document.getElementById('grandTotal').innerText=grandTotal.toFixed(2);
}


// HIGH QUALITY PDF
function downloadPDF(){

if(billItems.length===0){alert('No bill items');return;}

const storeName=document.getElementById('storeName').value || 'Laxmi Electronics';
const gstNo=document.getElementById('gstNo').value || '';
const invoiceNo=document.getElementById('invoiceNoInput').value || 'N/A';

const custName=document.getElementById('custName').value || 'N/A';
const custMobile=document.getElementById('custMobile').value || 'N/A';

const { jsPDF } = window.jspdf;
const doc = new jsPDF({ unit:'mm', format:'a4' });

// HEADER

doc.setFontSize(18);
doc.text(storeName.toUpperCase(),14,18);

doc.setFontSize(10);
doc.text(
'Old Indira Colony, Opposite Rajesh Thakur Bunglow, Beside Laxmi Provision and Coldrinks',
14,24,{maxWidth:120}
);

if(gstNo){
doc.text(`GST No: ${gstNo}`,14,30);
}

// LOGO BOX

doc.rect(160,10,30,20);
doc.text('LOGO',168,22);

// INVOICE INFO

doc.text(`Invoice No: ${invoiceNo}`,14,40);
doc.text(`Date: ${now.toLocaleString()}`,14,46);

// CUSTOMER

doc.text(`Customer: ${custName}`,14,56);
doc.text(`Mobile: ${custMobile}`,14,62);

// TABLE

doc.autoTable({
startY:70,
head:[['Item','Qty','Price','Total']],
body:billItems,
theme:'grid'
});

const finalY = doc.lastAutoTable.finalY + 10;

doc.text(`Grand Total: ₹ ${grandTotal.toFixed(2)}`,140,finalY);

// SAVE

doc.save(`Invoice_${invoiceNo}.pdf`);
}


// TESTS
console.assert(Array.isArray(products),'Products error');
console.assert(typeof grandTotal==='number','Total error');

</script>
</body>
</html>
